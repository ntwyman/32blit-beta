#include "game.hpp"

const uint8_t level1[] = {/* 0cd0 */
                          /*0x0cd0*/ 0x0d,
                          0x04,
                          0x00,
                          0x0a,
                          0x02,
                          0x01,
                          0x00,
                          0x13,
                          0x06,
                          0x01,
                          0x12,
                          0x0b,
                          0x02,
                          0x08,
                          0x0b,
                          0x0e,
                          /*0x0ce0*/ 0x12,
                          0x0c,
                          0x09,
                          0x0a,
                          0x0d,
                          0x0b,
                          0x0c,
                          0x0e,
                          0x0d,
                          0x0e,
                          0x0f,
                          0x0f,
                          0x10,
                          0x10,
                          0x03,
                          0x07,
                          /*0x0cf0*/ 0x11,
                          0x09,
                          0x0b,
                          0x15,
                          0x05,
                          0x09,
                          0x15,
                          0x0b,
                          0x10,
                          0x15,
                          0x12,
                          0x13,
                          0x03,
                          0x07,
                          0x0d,
                          0x07,
                          /*0x0d00*/ 0x02,
                          0x17,
                          0x0b,
                          0x02,
                          0x08,
                          0x10,
                          0x02,
                          0x08,
                          0x04,
                          0x02,
                          0x01,
                          0x07,
                          0x0d,
                          0x07,
                          0x12,
                          0x07,
                          /*0x0d10*/ 0x02,
                          0x0c,
                          0x0a,
                          0x0d,
                          0x11,
                          0x0c,
                          0x04,
                          0x11,
                          0x0a,
                          0x12,
                          0x06,
                          0x16,
                          0x0d,
                          0x16,
                          0x13,
                          0x16,
                          /*0x0d20*/ 0x02,
                          0x02,
                          0x0d,
                          0x02,
                          0x05,
                          0x07,
                          0x0e,
                          0x07,
                          0x05,
                          0x0c,
                          0x0f,
                          0x0c,
                          0x10,
                          0x10,
                          0x0b,
                          0x12,
                          /*0x0d30*/ 0x09,
                          0x16,
                          0x0e,
                          0x16,
                          0x05,
                          0x11,
                          0x08,
                          0x16,
                          0x04,
                          0x0c,
                          0x06,
                          0x07,
                          0x0c,
                          0x02};
const uint8_t level2[] = {/* 0d3e */
                          0x0d,
                          0x08,
                          /*0x0d40*/ 0x00,
                          0x07,
                          0x03,
                          0x01,
                          0x00,
                          0x03,
                          0x01,
                          0x05,
                          0x13,
                          0x06,
                          0x00,
                          0x06,
                          0x06,
                          0x08,
                          0x0a,
                          0x06,
                          /*0x0d50*/ 0x0c,
                          0x0e,
                          0x06,
                          0x10,
                          0x13,
                          0x0b,
                          0x00,
                          0x03,
                          0x0b,
                          0x05,
                          0x0e,
                          0x0b,
                          0x10,
                          0x13,
                          0x10,
                          0x00,
                          /*0x0d60*/ 0x0a,
                          0x10,
                          0x0c,
                          0x13,
                          0x15,
                          0x04,
                          0x0a,
                          0x15,
                          0x0c,
                          0x13,
                          0x02,
                          0x02,
                          0x12,
                          0x04,
                          0x11,
                          0x17,
                          /*0x0d70*/ 0x06,
                          0x07,
                          0x12,
                          0x09,
                          0x02,
                          0x08,
                          0x09,
                          0x0c,
                          0x17,
                          0x0d,
                          0x0c,
                          0x12,
                          0x11,
                          0x02,
                          0x0d,
                          0x11,
                          /*0x0d80*/ 0x11,
                          0x17,
                          0x05,
                          0x02,
                          0x0c,
                          0x02,
                          0x00,
                          0x07,
                          0x04,
                          0x07,
                          0x0d,
                          0x07,
                          0x00,
                          0x0c,
                          0x07,
                          0x0c,
                          /*0x0d90*/ 0x13,
                          0x0c,
                          0x07,
                          0x11,
                          0x07,
                          0x16,
                          0x0f,
                          0x16,
                          0x13,
                          0x16,
                          0x00,
                          0x02,
                          0x03,
                          0x02,
                          0x0f,
                          0x02,
                          /*0x0da0*/ 0x10,
                          0x07,
                          0x00,
                          0x11,
                          0x0a,
                          0x11,
                          0x0c,
                          0x16,
                          0x06,
                          0x16,
                          0x01,
                          0x02,
                          0x12,
                          0x0c,
                          0x0b,
                          0x0c,
                          /*0x0db0*/ 0x0d,
                          0x16};
const uint8_t level3[] = {/* 0db2 */
                          0x18,
                          0x07,
                          0x01,
                          0x0a,
                          0x03,
                          0x01,
                          0x00,
                          0x02,
                          0x02,
                          0x03,
                          0x04,
                          0x01,
                          0x07,
                          0x09,
                          /*0x0dc0*/ 0x01,
                          0x0b,
                          0x13,
                          0x05,
                          0x0f,
                          0x12,
                          0x0a,
                          0x00,
                          0x04,
                          0x0f,
                          0x00,
                          0x03,
                          0x13,
                          0x03,
                          0x04,
                          0x06,
                          /*0x0dd0*/ 0x07,
                          0x0a,
                          0x06,
                          0x0c,
                          0x0c,
                          0x07,
                          0x0e,
                          0x0e,
                          0x08,
                          0x0f,
                          0x0f,
                          0x09,
                          0x11,
                          0x11,
                          0x0a,
                          0x12,
                          /*0x0de0*/ 0x13,
                          0x0c,
                          0x0c,
                          0x0d,
                          0x0c,
                          0x0f,
                          0x0f,
                          0x0f,
                          0x12,
                          0x13,
                          0x10,
                          0x11,
                          0x11,
                          0x11,
                          0x0f,
                          0x0f,
                          /*0x0df0*/ 0x12,
                          0x0c,
                          0x0d,
                          0x13,
                          0x07,
                          0x0b,
                          0x15,
                          0x0d,
                          0x0f,
                          0x14,
                          0x10,
                          0x10,
                          0x14,
                          0x12,
                          0x13,
                          0x01,
                          /*0x0e00*/ 0x02,
                          0x0c,
                          0x03,
                          0x0b,
                          0x15,
                          0x08,
                          0x07,
                          0x15,
                          0x0a,
                          0x07,
                          0x15,
                          0x0d,
                          0x13,
                          0x17,
                          0x12,
                          0x02,
                          /*0x0e10*/ 0x07,
                          0x13,
                          0x0b,
                          0x11,
                          0x05,
                          0x04,
                          0x03,
                          0x0f,
                          0x02,
                          0x10,
                          0x06,
                          0x04,
                          0x0b,
                          0x04,
                          0x14,
                          0x09,
                          /*0x0e20*/ 0x07,
                          0x0f,
                          0x09,
                          0x0f,
                          0x0d,
                          0x01,
                          0x10,
                          0x11,
                          0x11,
                          0x13,
                          0x12,
                          0x13,
                          0x15,
                          0x02,
                          0x02,
                          0x02,
                          /*0x0e30*/ 0x0b,
                          0x07,
                          0x07,
                          0x07,
                          0x14,
                          0x00,
                          0x10,
                          0x0d,
                          0x02,
                          0x0c,
                          0x13,
                          0x0f,
                          0x12,
                          0x0d,
                          0x0d,
                          0x12,
                          /*0x0e40*/ 0x15,
                          0x02,
                          0x10,
                          0x09,
                          0x14,
                          0x11,
                          0x06,
                          0x00,
                          0x02,
                          0x08,
                          0x07};
const uint8_t level4[] = {/* 0e4b */
                          0x1a,
                          0x05,
                          0x01,
                          0x06,
                          0x04,
                          /*0x0e50*/ 0x01,
                          0x00,
                          0x04,
                          0x01,
                          0x06,
                          0x0a,
                          0x01,
                          0x0d,
                          0x13,
                          0x06,
                          0x00,
                          0x04,
                          0x06,
                          0x07,
                          0x0a,
                          0x06,
                          /*0x0e60*/ 0x0d,
                          0x11,
                          0x05,
                          0x13,
                          0x13,
                          0x0c,
                          0x00,
                          0x01,
                          0x0d,
                          0x03,
                          0x03,
                          0x0e,
                          0x05,
                          0x05,
                          0x0f,
                          0x07,
                          /*0x0e70*/ 0x08,
                          0x0b,
                          0x07,
                          0x08,
                          0x0b,
                          0x0d,
                          0x10,
                          0x0a,
                          0x12,
                          0x13,
                          0x10,
                          0x08,
                          0x0a,
                          0x11,
                          0x00,
                          0x00,
                          /*0x0e80*/ 0x12,
                          0x02,
                          0x02,
                          0x13,
                          0x03,
                          0x03,
                          0x14,
                          0x04,
                          0x04,
                          0x15,
                          0x05,
                          0x05,
                          0x15,
                          0x07,
                          0x0a,
                          0x10,
                          /*0x0e90*/ 0x0d,
                          0x0e,
                          0x10,
                          0x10,
                          0x10,
                          0x10,
                          0x12,
                          0x13,
                          0x15,
                          0x0d,
                          0x0f,
                          0x15,
                          0x11,
                          0x13,
                          0x03,
                          0x02,
                          /*0x0ea0*/ 0x08,
                          0x08,
                          0x02,
                          0x17,
                          0x0e,
                          0x0c,
                          0x17,
                          0x0f,
                          0x02,
                          0x08,
                          0x13,
                          0x10,
                          0x17,
                          0x0b,
                          0x00,
                          0x02,
                          /*0x0eb0*/ 0x00,
                          0x0d,
                          0x00,
                          0x12,
                          0x07,
                          0x07,
                          0x09,
                          0x11,
                          0x0d,
                          0x02,
                          0x10,
                          0x07,
                          0x0d,
                          0x0c,
                          0x13,
                          0x0b,
                          /*0x0ec0*/ 0x11,
                          0x10,
                          0x10,
                          0x15,
                          0x10,
                          0x18,
                          0x00,
                          0x07,
                          0x0a,
                          0x02,
                          0x12,
                          0x02,
                          0x05,
                          0x0f,
                          0x09,
                          0x16,
                          /*0x0ed0*/ 0x0d,
                          0x16,
                          0x0a,
                          0x16,
                          0x11,
                          0x16,
                          0x11,
                          0x02,
                          0x04,
                          0x02,
                          0x0a,
                          0x07};
const uint8_t level5[] = {/* 0edc */
                          0x11,
                          0x09,
                          0x01,
                          0x0d,
                          /*0x0ee0*/ 0x04,
                          0x01,
                          0x00,
                          0x01,
                          0x01,
                          0x03,
                          0x0b,
                          0x01,
                          0x0d,
                          0x0f,
                          0x01,
                          0x12,
                          0x13,
                          0x06,
                          0x00,
                          0x05,
                          /*0x0ef0*/ 0x06,
                          0x09,
                          0x0c,
                          0x06,
                          0x0e,
                          0x0f,
                          0x0b,
                          0x00,
                          0x05,
                          0x0b,
                          0x0a,
                          0x0f,
                          0x0b,
                          0x13,
                          0x13,
                          0x10,
                          /*0x0f00*/ 0x00,
                          0x05,
                          0x15,
                          0x03,
                          0x07,
                          0x14,
                          0x09,
                          0x09,
                          0x13,
                          0x0b,
                          0x0d,
                          0x12,
                          0x0e,
                          0x0e,
                          0x16,
                          0x0c,
                          /*0x0f10*/ 0x0f,
                          0x15,
                          0x12,
                          0x13,
                          0x03,
                          0x02,
                          0x08,
                          0x02,
                          0x0c,
                          0x12,
                          0x04,
                          0x0c,
                          0x17,
                          0x07,
                          0x02,
                          0x07,
                          /*0x0f20*/ 0x07,
                          0x0a,
                          0x11,
                          0x0a,
                          0x02,
                          0x08,
                          0x0c,
                          0x07,
                          0x0d,
                          0x0c,
                          0x14,
                          0x18,
                          0x0e,
                          0x02,
                          0x08,
                          0x10,
                          /*0x0f30*/ 0x00,
                          0x02,
                          0x00,
                          0x07,
                          0x00,
                          0x0c,
                          0x00,
                          0x11,
                          0x05,
                          0x07,
                          0x05,
                          0x16,
                          0x09,
                          0x0b,
                          0x0d,
                          0x06,
                          /*0x0f40*/ 0x0b,
                          0x14,
                          0x0d,
                          0x17,
                          0x13,
                          0x0c,
                          0x13,
                          0x16,
                          0x04,
                          0x02,
                          0x05,
                          0x02,
                          0x06,
                          0x02,
                          0x0d,
                          0x02,
                          /*0x0f50*/ 0x0f,
                          0x02,
                          0x12,
                          0x02,
                          0x0a,
                          0x0c,
                          0x0f,
                          0x0c,
                          0x03,
                          0x16,
                          0x06,
                          0x16,
                          0x07,
                          0x16,
                          0x0f,
                          0x17,
                          /*0x0f60*/ 0x12,
                          0x16,
                          0x01,
                          0x07,
                          0x03,
                          0x0c,
                          0x01,
                          0x11,
                          0x0e,
                          0x0c,
                          0x0f,
                          0x07};
const uint8_t level6[] = {
    /* 0f6c */
    0x10,
    0x06,
    0x01,
    0x09,
    /*0x0f70*/ 0x04,
    0x01,
    0x00,
    0x02,
    0x01,
    0x06,
    0x08,
    0x01,
    0x0b,
    0x0e,
    0x06,
    0x00,
    0x01,
    0x06,
    0x03,
    0x05,
    /*0x0f80*/ 0x06,
    0x0c,
    0x0e,
    0x0b,
    0x02,
    0x07,
    0x0b,
    0x0c,
    0x11,
    0x0a,
    0x11,
    0x13,
    0x10,
    0x00,
    0x05,
    0x10,
    /*0x0f90*/ 0x10,
    0x13,
    0x15,
    0x06,
    0x06,
    0x15,
    0x08,
    0x08,
    0x14,
    0x0c,
    0x11,
    0x16,
    0x11,
    0x13,
    0x02,
    0x11,
    /*0x0fa0*/ 0x11,
    0x00,
    0x02,
    0x08,
    0x04,
    0x04,
    0x12,
    0x0e,
    0x07,
    0x0d,
    0x0e,
    0x13,
    0x17,
    0x11,
    0x02,
    0x0d,
    /*0x0fb0*/ 0x11,
    0x10,
    0x18,
    0x09,
    0x02,
    0x02,
    0x10,
    0x02,
    0x05,
    0x07,
    0x0c,
    0x07,
    0x0c,
    0x0c,
    0x10,
    0x0c,
    /*0x0fc0*/ 0x07,
    0x11,
    0x03,
    0x15,
    0x06,
    0x16,
    0x0c,
    0x15,
    0x13,
    0x11,
    0x13,
    0x17,
    0x0b,
    0x02,
    0x0c,
    0x02,
    /*0x0fd0*/ 0x0d,
    0x02,
    0x0e,
    0x02,
    0x00,
    0x11,
    0x02,
    0x11,
    0x03,
    0x11,
    0x07,
    0x0c,
    0x13,
    0x0b,
    0x01,
    0x11,
    /*0x0fe0*/ 0x01,
    0x02,
    0x12,
    0x11,
    0x0d,
    0x07,
    0x12,
    0x0b,
};
const uint8_t level7[] = {
    /* 0fe8 */
    0x17,
    0x07,
    0x01,
    0x04,
    0x03,
    0x15,
    0x0b,
    0x10,
    /*0x0ff0*/ 0x10,
    0x00,
    0x04,
    0x10,
    0x06,
    0x07,
    0x0b,
    0x00,
    0x02,
    0x06,
    0x01,
    0x03,
    0x04,
    0x00,
    0x01,
    0x01,
    /*0x1000*/ 0x03,
    0x04,
    0x02,
    0x05,
    0x06,
    0x01,
    0x07,
    0x08,
    0x02,
    0x09,
    0x09,
    0x03,
    0x09,
    0x09,
    0x03,
    0x0c,
    /*0x1010*/ 0x0c,
    0x08,
    0x05,
    0x08,
    0x09,
    0x05,
    0x05,
    0x0a,
    0x05,
    0x05,
    0x0b,
    0x05,
    0x05,
    0x0c,
    0x05,
    0x05,
    /*0x1020*/ 0x0b,
    0x08,
    0x08,
    0x0c,
    0x08,
    0x08,
    0x0f,
    0x0c,
    0x0f,
    0x0b,
    0x0a,
    0x0b,
    0x09,
    0x0e,
    0x10,
    0x02,
    /*0x1030*/ 0x0f,
    0x10,
    0x01,
    0x02,
    0x12,
    0x03,
    0x02,
    0x08,
    0x05,
    0x14,
    0x18,
    0x07,
    0x14,
    0x18,
    0x09,
    0x14,
    /*0x1040*/ 0x18,
    0x0d,
    0x10,
    0x17,
    0x0f,
    0x0a,
    0x11,
    0x12,
    0x06,
    0x17,
    0x08,
    0x17,
    0x0a,
    0x17,
    0x0f,
    0x16,
    /*0x1050*/ 0x07,
    0x11,
    0x02,
    0x03,
    0x07,
    0x09,
    0x0b,
    0x0c,
    0x10,
    0x0f,
    0x10,
    0x0a,
    0x0c,
    0x04,
    0x11,
    0x02,
    /*0x1060*/ 0x02,
    0x07,
    0x03,
    0x11,
    0x08,
    0x09,
    0x0c,
    0x16,
    0x0d,
    0x16,
    0x01,
    0x11,
    0x0e,
    0x0a,
    0x00,
    0x05,
    /*0x1070*/ 0x02,
    0x0c,
};
const uint8_t level8[] = {
    /* 1072 */
    0x0f,
    0x06,
    0x00,
    0x10,
    0x03,
    0x01,
    0x00,
    0x13,
    0x06,
    0x02,
    0x04,
    0x06,
    0x07,
    0x0d,
    /*0x1080*/ 0x06,
    0x10,
    0x12,
    0x0b,
    0x02,
    0x05,
    0x0b,
    0x08,
    0x0c,
    0x0b,
    0x0f,
    0x12,
    0x10,
    0x03,
    0x06,
    0x10,
    /*0x1090*/ 0x09,
    0x0b,
    0x10,
    0x0e,
    0x11,
    0x15,
    0x03,
    0x03,
    0x15,
    0x06,
    0x06,
    0x15,
    0x08,
    0x0c,
    0x15,
    0x0e,
    /*0x10a0*/ 0x0e,
    0x15,
    0x11,
    0x11,
    0x03,
    0x02,
    0x08,
    0x11,
    0x02,
    0x08,
    0x0a,
    0x07,
    0x0d,
    0x04,
    0x0c,
    0x12,
    /*0x10b0*/ 0x10,
    0x0c,
    0x12,
    0x0a,
    0x11,
    0x17,
    0x05,
    0x06,
    0x0f,
    0x06,
    0x06,
    0x0b,
    0x0e,
    0x0b,
    0x08,
    0x10,
    /*0x10c0*/ 0x0c,
    0x10,
    0x05,
    0x15,
    0x0f,
    0x15,
    0x07,
    0x15,
    0x0d,
    0x15,
    0x03,
    0x18,
    0x11,
    0x18,
    0x01,
    0x02,
    /*0x10d0*/ 0x02,
    0x02,
    0x04,
    0x02,
    0x05,
    0x02,
    0x06,
    0x02,
    0x08,
    0x02,
    0x09,
    0x02,
    0x0a,
    0x02,
    0x0b,
    0x02,
    /*0x10e0*/ 0x0c,
    0x02,
    0x0d,
    0x02,
    0x0e,
    0x02,
    0x0f,
    0x02,
    0x10,
    0x02,
    0x12,
    0x02,
    0x13,
    0x02,
    0x11,
    0x02,
    /*0x10f0*/ 0x0a,
    0x0c,
    0x0a,
    0x16,
    0x03,
    0x11,
    0x11,
    0x11,
    0x55,
    0x42,
    0x28,
    0x34,
    0x29,
    0x3a,
    0x20,
    0x45,
};

const uint8_t *const levels[8] = {&level1[0], &level2[0], &level3[0],
                                  &level4[0], &level5[0], &level6[0],
                                  &level7[0], &level8[0]};

void Game::LoadLevel(int levelNumber) {
  /* Get faster as we go up through the levels
  i = level_index >> 4;
  if (i > 8) {
      i = 8;
  }
  timer_ticks[0] = 9 - i;
  timer_ticks[1] = 0;
  timer_ticks[2] = 0;
  */

  // Data for the level
  const uint8_t *p = levels[levelNumber];
  int num_walls = *(p++);
  int x, y;
  int num_ladders = *(p++);
  const int have_lift = *(p++);
  const int num_grain = *(p++);
  const int num_ducks = *(p++);
  bzero(&tiles[0], sizeof(tiles));

  while (num_walls--) {
    y = *(p++);       // row
    x = *(p++);       // first column
    int end = *(p++); // last column
    while (x <= end) {
      setTile(x, y, TILE_WALL);
      x++;
    }
  }

  while (num_ladders--) {
    x = *(p++);
    y = *(p++);
    int end = *(p++);
    while (y <= end) {
      addToTile(x, y, TILE_LADDER);
      y++;
    }
  }

  if (have_lift) {
    // lift_x = *(p++) << 3;
    p++;
  }

  // eggs_left = 0;
  for (int i = 0; i < 0xc; i++) {
    p += 2; // For now
            /*    	x = *(p++);
                        y = *(p++);
                        if (player_data->egg[i] == 0) {
                            Do_InitTile(x, y, (i << 4) | TILE_EGG);
                            eggs_left++;
                        }
             */
  }

  for (int i = 0; i < num_grain; i++) {
    p += 2;
/*            x = *(p++);
            y = *(p++);
        if (player_data->grain[i] == 0) {
            Do_InitTile(x, y, (i << 4) | TILE_GRAIN);
        }
*/    }

/*    for (i = 0; i < 5 ; i++) {
        duck[i].tile_x = *(p++);
        duck[i].tile_y = *(p++);
    }
*/
}

void Game::Render(surface &fb) {
  // fb.rectangle(rect(point(20,20), point(40,40)));
  const rect &copy_from = rect(point(0, 0), size(8, 8));
  for (int x = 0; x < COLUMNS; x++) {
    for (int y = 0; y < ROWS; y++) {
      const point &pos = point(80 + x * STRIDE, 220 - (y * STRIDE));
      uint8_t tile = getTile(x, y);
      if (tile & TILE_WALL) {
        fb.sprite(point(9, 0), pos);
      }
      if (tile & TILE_LADDER) {
        fb.sprite(point(9, 1), pos);
      }
    }
  }
}